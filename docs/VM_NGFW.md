Развертывание виртуальной машины PT NGFW

Требования для конечного окружения
Более подробная информация о требованиях для конечного окружения приведена в разделе «Программные и аппаратные требования» Справки PT NGFW.

Для работы межсетевого экрана виртуальная машина должна поддерживать технологию huge pages.
При необходимости создания кластера на виртуальных машинах с использованием виртуального MAC-адреса в гипервизоре должны быть включены параметры Promiscuous Mode, MAC Address Changes и Forged Transmits.

Развертывание виртуальной машины в среде ESXi
Чтобы развернуть виртуальную машину в среде ESXi:
Начните процесс создания новой виртуальной машины, нажав Create / Register VM.

Создание виртуальной машины
Выберите тип развертывания из образа OVF.

Развертывание из образа OVF
Выберите файлы расширений OVF и VMDK.
Введите имя виртуальной машины.

Ввод имени виртуальной машины и выбор файлов
Выберите хранилище.

Выбор хранилища
Выберите маппинг интерфейсов на подсети виртуализации.

Выбор маппинга интерфейсов
Нажмите FINISH.

Завершение развертывания виртуальной машины в среде ESXi

Развертывание виртуальной машины в среде KVM
Чтобы развернуть виртуальную машину в среде KVM:
Начните процесс импортирования виртуальной машины, нажав Import VM.

Импортирование виртуальной машины
Введите параметры импортируемой машины и нажмите Import and run.

Ввод параметров импортируемой машины
По завершении импортирования измените параметры процессора:
Укажите количество ядер.

Параметры процессора (количество ядер)
Укажите тип процессора.

Параметры процессора (тип процессора)
Добавьте сетевые интерфейсы.

Сетевые интерфейсы
Готовые образы рассчитаны на 8 сетевых интерфейсов.
Запустите виртуальную машину.
Просмотрите список адаптеров и убедитесь в корректности их адресов:

sudo lspci | grep -i eth

Просмотр списка адаптеров
В этом примере адаптер по адресу 08:00.0 это интерфейс eth1-1, адаптер по адресу 09:00.0 это интерфейс eth1-2 и т. д.
Если требуется, измените в файле pt-ngfw.conf в разделе devices адреса адаптеров eth1-1, eth1-2, eth1-3, eth1-4, eth1-5 и eth1-6 (значение addr):

sudo nano /opt/pt-ngfw/ngfw-core/etc/config/pt-ngfw.conf

Содержимое файла pt-ngfw.conf
Перезапустите сервис, чтобы изменения вступили в силу:

sudo systemctl restart pt-ngfw-core.service

Настройка интерфейса управления (MGMT)
Чтобы настроить интерфейс управления:
Подключитесь к консоли управления виртуальной машины.
Войдите в учетную запись ОС, используя логин ngfw и пароль p0sitive.
Измените параметры сетевого интерфейса ens192:

sudo nano /etc/network/interfaces

Параметры сетевого интерфейса ens192
Перезапустите сервис, чтобы изменения вступили в силу:

sudo systemctl restart networking.service

Настройка DNS-сервера в ОС
Настройка DNS-сервера нужна для корректной работы сервисов. Для этого необходимо указать в параметрах внутренний или внешний DNS-сервер.

Чтобы настроить DNS-сервер:
Откройте конфигурационный файл resolv.conf:

sudo nano /etc/resolv.conf
Добавьте DNS-сервер:

Содержимое файла resolv.conf
Адрес указанного DNS-сервера (серверов) используется базовой операционной системой и не влияет на разрешение FQDN в политиках безопасности процессом PT NGFW.

Подключение межсетевого экрана к DNS-серверу (серверам) для разрешения FQDN в политиках безопасности
Чтобы подключить межсетевой экран к DNS-серверу (серверам):
В конфигурационном файле pt-ngfw.conf в блоке dns_resolver укажите параметр servers:

sudo nano /opt/pt-ngfw/ngfw-core/etc/config/pt-ngfw.conf
Если DNS-серверов несколько, их адреса вводятся через запятую без пробелов.

Содержимое файла pt-ngfw.conf
Перезапустите сервис, чтобы изменения вступили в силу:

sudo systemctl restart pt-ngfw-core.service

Настройка NTP-сервера
Для корректной работы систем журналирования и мониторинга необходимо синхронизировать время на серверах. Для этого используются NTP-серверы.

Чтобы настроить NTP-сервер:
Откройте конфигурационный файл timesyncd.conf:

sudo nano /etc/systemd/timesyncd.conf
Раскомментируйте строку NTP и пропишите адрес NTP-сервера по своему усмотрению:

Содержимое файла timesyncd.conf
Перезапустите сервис, чтобы изменения вступили в силу:

sudo systemctl restart systemd-timesyncd
Вы можете проверить работоспособность службы с помощью команды:

timedatectl timesync-status

Подключение межсетевого экрана к системе управления
Чтобы подключить межсетевой экран к системе управления:
Подключитесь к веб-интерфейсу системы управления, используя логин admin и пароль admin.
При первом входе в систему потребуется сменить пароль.
На странице Devices нажмите Add device.

Добавление устройств
Введите серийный номер устройства.
Серийный номер межсетевого экрана можно узнать с помощью команды, выполненной на межсетевом экране:

cat /opt/pt-ngfw/ngfw-core/etc/config/pt-ngfw.conf | grep -i serial
Введите IP-адрес интерфейса управления устройства или FQDN.
Разрешение FQDN происходит в соответствии с системными параметрами ОС.

IP-адрес и серийный номер межсетевого экрана
Нажмите Push to devices, чтобы изменения вступили в силу.

Завершение подключения межсетевого экрана к системе управления

Первичная настройка интерфейсов
Чтобы произвести первичную настройку интерфейсов:
Подключитесь к веб-интерфейсу системы управления.
На странице Devices выберите подключенное устройство.
В контекстном меню нужного субинтерфейса нажмите Edit.

Выбор субинтерфейса
Укажите обязательные параметры субинтерфейса: Mode, IP address, Virtual context и Security zone.
Зона безопасности Local является служебной и не предусмотрена для назначения субинтерфейсам.

Параметры субинтерфейса
Нажмите Push to devices, чтобы изменения вступили в силу.