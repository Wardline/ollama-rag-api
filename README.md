–ë—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RAG (Retrieval-Augmented Generation).  
–ü—Ä–æ–µ–∫—Ç —É–º–µ–µ—Ç:
1. –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã;
2. —Ä–∞–∑–±–∏–≤–∞—Ç—å –∏—Ö –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å;
3. –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã;
4. —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç —Å –æ–ø–æ—Ä–æ–π –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—è LLM (Ollama).

–ü—Ä–æ–µ–∫—Ç –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–µ–π –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ NGFW:

[–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã PT NGFW](https://help.ptsecurity.com/ru-RU/projects/ngfw/1.8/qsguide/9367413259)

[–ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ü–ê–ö PT NGFW](https://help.ptsecurity.com/ru-RU/projects/ngfw/1.8/qsguide/9380723723)

–í —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ª–æ–∫–∞–ª—å–Ω—ã–µ .md-–≤–µ—Ä—Å–∏–∏ —ç—Ç–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API /ingest/docs.
---

## –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **—Ç—Ä—ë—Ö —Å–ª–æ—ë–≤**:

1. **API-—Å–ª–æ–π (FastAPI)** ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã:
   - `/ingest/docs` ‚Äî –∑–∞–ª–∏–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ —Ñ–∞–π–ª–∞—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ md/txt);
   - `/chat` ‚Äî –¥–∏–∞–ª–æ–≥ —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.
   –≠—Ç–æ —Ç–æ–Ω–∫–∏–π —Å–ª–æ–π, —Ç–∞–º –ø–æ—á—Ç–∏ –Ω–µ—Ç –ª–æ–≥–∏–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –≤—ã–∑–æ–≤—ã —Å–µ—Ä–≤–∏—Å–æ–≤.

2. **–°–ª–æ–π RAG (app/rag)** ‚Äî —Ç—É—Ç –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:
   - —Ä–∞–∑–±–æ—Ä –∏ –Ω–∞—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —á–∞–Ω–∫–∏ (`split_text`);
   - –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏, —Å–µ–π—á–∞—Å ‚Äî **SBERT**);
   - –ø–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É –∏–Ω–¥–µ–∫—Å—É (**FAISS**).

3. **LLM-—Å–ª–æ–π** ‚Äî —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç –∫ **Ollama**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç —É–∂–µ ¬´—Å–æ–±—Ä–∞–Ω–Ω—ã–π¬ª –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –í –∫–æ–Ω—Ñ–∏–≥–µ –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –∏ –¥–ª—è OpenAI, –Ω–æ —Ç–µ–∫—É—â–∞—è —Å–±–æ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Ollama.

–°–≤–µ—Ä—Ö—É –Ω–∞–¥ —ç—Ç–∏–º –≤—Å–µ–º ‚Äî **Docker Compose**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∏ API, –∏ Ollama, –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –ø–∞–ø–∫–∏ –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –∫–µ—à–∞ –º–æ–¥–µ–ª–µ–π.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

- `app/main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –ó–¥–µ—Å—å —Å–æ–∑–¥–∞—ë—Ç—Å—è FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Ä–æ—É—Ç–µ—Ä—ã (`/chat`, `/ingest/docs`), –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è CORS, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç.–ø.
- `app/core/config.py` ‚Äî –µ–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è. –û—Ç—Å—é–¥–∞ –±–µ—Ä—É—Ç—Å—è:
  - –∫–∞–∫–æ–π LLM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (`llm_provider`);
  - –∫—É–¥–∞ —Ö–æ–¥–∏—Ç—å –∑–∞ –º–æ–¥–µ–ª—å—é (`ollama_host`);
  - –∫–∞–∫–æ–π –±—ç–∫–µ–Ω–¥ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (`embedding_backend=sbert`);
  - –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å FAISS-–∏–Ω–¥–µ–∫—Å (`rag_index_path=/app/data/rag_store`);
  - —Å–∫–æ–ª—å–∫–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç (`k_top=4`).
  –ó–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ `.env`.

- `app/api/routers/chat.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∏–∞–ª–æ–≥–∞. –û–Ω:
  1. –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `{"query": "‚Ä¶"}`
  2. –±–µ—Ä—ë—Ç —Ç–æ–ø-K —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –∏–Ω–¥–µ–∫—Å–∞;
  3. —Å–∫–ª–µ–∏–≤–∞–µ—Ç –∏—Ö –≤ –µ–¥–∏–Ω—ã–π ¬´–∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª;
  4. –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Ollama;
  5. –æ—Ç–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–≤–µ—Ç –∏ —Ç–æ, –∫–∞–∫–∏–µ –∫—É—Å–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å.

- `app/api/routers/ingest.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ `multipart/form-data`, —Ä–µ–∂–µ—Ç –∏—Ö –Ω–∞ –∫—É—Å–∫–∏, –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ retriever.

- `app/rag/retriever.py` ‚Äî —Å–µ—Ä–¥—Ü–µ RAG:
  - —Å—á–∏—Ç–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏;
  - —Å–æ–∑–¥–∞—ë—Ç FAISS-–∏–Ω–¥–µ–∫—Å (–µ—Å–ª–∏ –µ–≥–æ –µ—â—ë –Ω–µ—Ç);
  - –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ –∏–Ω–¥–µ–∫—Å;
  - –∏—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.

- `app/rag/ingest.py` ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –Ω–∞—Ä–µ–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ PDF/HTML) –∏ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è –∏—Ö –≤ –∑–∞–ø–∏—Å–∏ –≤–∏–¥–∞ `{source, text}`.

- `docker-compose.yml` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–≤–∞ —Å–µ—Ä–≤–∏—Å–∞:
  - `api` (–Ω–∞—à –±—ç–∫–µ–Ω–¥)
  - `ollama` (LLM-—Å–µ—Ä–≤–µ—Ä)
  –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç:
  - `./data/rag_store ‚Üí /app/data/rag_store` ‚Äî —Ç—É—Ç –ª–µ–∂–∏—Ç FAISS
  - `hf_cache ‚Üí /root/.cache/huggingface` ‚Äî —á—Ç–æ–±—ã SBERT –Ω–µ –∫–∞—á–∞–ª—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫:

### 1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ–∞–π–ª `.env`:

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# LLM 
OPENAI_API_KEY=sk-api
OPENAI_MODEL=gpt-4o-mini
# OPENAI_BASE_URL=http://localhost:1234/v1

LLM_PROVIDER=ollama
OLLAMA_HOST=http://ollama:11434
OLLAMA_MODEL=llama3.1

EMBEDDING_BACKEND=sbert
EMBEDDING_MODEL=multi-qa-MiniLM-L6-cos-v1

K_TOP=4
```
### 2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (PowerShell):

```powershell
# –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker compose up --build
```

---

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ API –±—É–¥–µ—Ç –Ω–∞ `http://localhost:8000`.

---

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (PowerShell):

### 1. –î–∏–∞–ª–æ–≥ —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º:

```powershell
Invoke-RestMethod -Uri 'http://localhost:8000/chat' `
  -Method Post `
  -ContentType 'application/json; charset=utf-8' `
  -Body '{"query":"–ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂—Å–µ—Ç–µ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∫ DNS-—Å–µ—Ä–≤–µ—Ä—É (—Å–µ—Ä–≤–µ—Ä–∞–º)?"}' |
  ConvertTo-Json -Depth 10
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```json
{
  "answer": "–ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω –∫ DNS-—Å–µ—Ä–≤–µ—Ä—É (—Å–µ—Ä–≤–µ—Ä–∞–º), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:...",
  "context_used": [
    {
      "text": "DNS-—Å–µ—Ä–≤–µ—Ä—É (—Å–µ—Ä–≤–µ—Ä–∞–º) –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è FQDN –≤ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...",
      "source": "PAC_NGFW.md",
      "chunk_id": null
    }
  ]
}
```

---

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

```powershell
curl.exe -F "files=@docs/PAC_NGFW.md" http://localhost:8000/ingest/docs
```
*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* `PAC_NGFW.md` ‚Äî –∏–º—è –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞.

–ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø–æ—Ä–µ–∑–∞–ª—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤ FAISS ‚Äî –±—É–¥–µ—Ç –ø–æ–¥–æ–±–Ω—ã–π –≤—ã–≤–æ–¥:

```json
{"ingested_chunks":6,"errors":[]}
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞, –∂–∏–≤ –ª–∏ —Å–µ—Ä–≤–µ—Ä:

```powershell
Invoke-RestMethod -Uri 'http://localhost:8000/health'
```

---

## –ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:

- **`curl: (52) Empty reply from server`** ‚Äî –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ø–∞–ª –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é SBERT/FAISS, —Å–µ—Ä–≤–µ—Ä –Ω–µ —É—Å–ø–µ–ª –æ—Ç–≤–µ—Ç–∏—Ç—å. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –ø—Ä–æ–≥—Ä–µ–π—Ç–µ –º–æ–¥–µ–ª—å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.

---

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ª—ë–≥–∫–∏–π –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –±—ç–∫–µ–Ω–¥ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π Retrieval-Augmented Generation (RAG), 
–ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ FastAPI, FAISS –∏ SBERT. 
–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–π LLM (Ollama).


--- 